Host: Ubuntu OS

(1) Download source to host OS
$ cd ~/src/
$ git clone https://github.com/zenodo/zenodo.git

(2) Build docker images and containers
docker-compose build

(3) Start docker containers build in step2. This step could be done before step9.
docker-compose up db es cache mq

(4) Check and clean OS default python environment. Install python3 and make it as the default python env.
sudo apt-get update
sudo apt-get install -y python3-pip
# add following 2 lines to ~/.bashrc file to make python3 as default.
# alias python=python3
# alias pip=pip3

(5) Install 2 python modules: virtualenv and virtualenvwrapper.
sudo apt-get install python-virtualenv
sudo apt-get install virtualenvwrapper

(6) Install nodejs on host os
# Install Node.js 7.x repository
sudo curl -sL https://deb.nodesource.com/setup_7.x | sudo bash -
# Install Node.js and npm
apt-get install -y nodejs

(7) Create virtual python environment
mkdir /home/envs
### Append following 3 lines to the end of ~/.bashrc file, and do "source ~/.bashrc" after saving the file. 
### The path on the 3rd line should be the actual path where virtualenvwrapper.sh is installed.
    export WORKON_HOME=$HOME/.virtualenvs
    export PROJECT_HOME=$HOME/envs
    source /usr/local/bin/virtualenvwrapper.sh
mkvirtualenv zenodo

(8) Build zenodo on host os, this should be done under virtual python environment created in step7.
(zenodo)$
(zenodo)$ cd ~/src/zenodo
(zenodo)$ pip install -r requirements.txt --src ~/src/ --pre --upgrade
(zenodo)$ pip install -e .[all,postgresql,elasticsearch2]

(zenodo)$ sudo ./scripts/setup-npm.sh
# install nodejs modules system-wide. Output when finished:
# /usr/lib
# ├── clean-css@3.4.19 
# ├─┬ node-sass@3.8.0 
# │ └─┬ request@2.85.0
# │   └── aws4@1.7.0 
# ├── requirejs@2.2.0 
# └── uglify-js@2.7.3

(zenodo)$ ./scripts/setup-assets.sh
# Output when finished:
# 474 of 474 files already present
# Done collecting.
# Building bundle: gen/search.%(version)s.js
# Building bundle: gen/zenodo.search.%(version)s.js
# Building bundle: gen/styles.%(version)s.css
# Building bundle: gen/packed.%(version)s.js
# Building bundle: gen/pdfjs.%(version)s.css
# Building bundle: gen/deposit.%(version)s.js
# Building bundle: gen/pdfjs.%(version)s.js
# Building bundle: gen/github.%(version)s.js
# Building bundle: gen/prism.%(version)s.css
# Building bundle: gen/deposit.%(version)s.css
# Building bundle: gen/zenodo.%(version)s.css
# Building bundle: gen/communities.%(version)s.js
# Building bundle: gen/csv_previewer.%(version)s.js
# Building bundle: gen/styles.admin.%(version)s.css
# Building bundle: gen/admin.%(version)s.js
# Building bundle: gen/fullscreen.%(version)s.js
# Building bundle: gen/github.%(version)s.css
# Building bundle: gen/deposit.dependencies.%(version)s.js
# Building bundle: gen/zenodo.%(version)s.js
# Building bundle: gen/zenodo.deposit.%(version)s.js
# Building bundle: gen/i18n.%(version)s.js
# Building bundle: gen/prism.%(version)s.js
# Building bundle: gen/styles.admin-lte.%(version)s.css
# Building bundle: gen/translations/invenio-search-ui.js
# Building bundle: gen/search.%(version)s.css
# Building bundle: gen/communities.%(version)s.css


(9) Initialize zenodo:
(zenodo)$ ./scripts/init.sh
# init.sh failed here on my machine
Creating all tables!
  [####################################]  100%
INFO  [alembic.runtime.migration] Context impl PostgresqlImpl.
INFO  [alembic.runtime.migration] Will assume transactional DDL.
Created all tables!
Indexing queue has been initialized.
Creating indexes...
  [------------------------------------]    0%
Traceback (most recent call last):
  File "/home/kk/.virtualenvs/zenodo/bin/zenodo", line 11, in <module>
    load_entry_point('zenodo', 'console_scripts', 'zenodo')()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 257, in decorator
    return __ctx.invoke(f, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/invenio_search/cli.py", line 44, in inner
    return f(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/invenio_search/cli.py", line 74, in init
    for name, response in bar:
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/_termui_impl.py", line 259, in next
    rv = next(self.iter)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/invenio_search/ext.py", line 265, in create
    for result in _create(self.active_aliases):
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/invenio_search/ext.py", line 248, in _create
    for result in _create(value, alias=name):
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/invenio_search/ext.py", line 255, in _create
    ignore=ignore,
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/elasticsearch/client/utils.py", line 69, in _wrapped
    return func(*args, params=params, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/elasticsearch/client/indices.py", line 110, in create
    params=params, body=body)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/elasticsearch/transport.py", line 327, in perform_request
    status, headers, data = connection.perform_request(method, url, params, body, ignore=ignore, timeout=timeout)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/elasticsearch/connection/http_requests.py", line 84, in perform_request
    self._raise_error(response.status_code, raw_data)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/elasticsearch/connection/base.py", line 114, in _raise_error
    raise HTTP_EXCEPTIONS.get(status_code, TransportError)(status_code, error_message, additional_info)
elasticsearch.exceptions.RequestError: TransportError(400, u'index_already_exists_exception', u'already exists')
Traceback (most recent call last):
  File "/home/kk/.virtualenvs/zenodo/bin/zenodo", line 11, in <module>
    load_entry_point('zenodo', 'console_scripts', 'zenodo')()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 257, in decorator
    return __ctx.invoke(f, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/cli.py", line 60, in init
    loadoaisets()
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/oai.py", line 43, in loadoaisets
    db.session.commit()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/scoping.py", line 153, in do
    return getattr(self.registry(), name)(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 943, in commit
    self.transaction.commit()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 467, in commit
    self._prepare_impl()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 447, in _prepare_impl
    self.session.flush()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2254, in flush
    self._flush(objects)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2380, in _flush
    transaction.rollback(_capture_exception=True)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/util/langhelpers.py", line 66, in __exit__
    compat.reraise(exc_type, exc_value, exc_tb)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2344, in _flush
    flush_context.execute()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/unitofwork.py", line 391, in execute
    rec.execute(self)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/unitofwork.py", line 556, in execute
    uow
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/persistence.py", line 181, in save_obj
    mapper, table, insert)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/persistence.py", line 866, in _emit_insert_statements
    execute(statement, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 948, in execute
    return meth(self, multiparams, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/sql/elements.py", line 269, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1060, in _execute_clauseelement
    compiled_sql, distilled_params
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1200, in _execute_context
    context)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1413, in _handle_dbapi_exception
    exc_info
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/util/compat.py", line 203, in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb, cause=cause)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1193, in _execute_context
    context)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/default.py", line 507, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.IntegrityError) duplicate key value violates unique constraint "uq_oaiserver_set_spec"
DETAIL:  Key (spec)=(openaire) already exists.
 [SQL: 'INSERT INTO oaiserver_set (created, updated, spec, name, description, search_pattern) VALUES (%(created)s, %(updated)s, %(spec)s, %(name)s, %(description)s, %(search_pattern)s) RETURNING oaiserver_set.id'] [parameters: {'updated': datetime.datetime(2018, 4, 7, 4, 26, 14, 355770), 'name': 'OpenAIRE', 'created': datetime.datetime(2018, 4, 7, 4, 26, 14, 355762), 'search_pattern': None, 'spec': 'openaire', 'description': None}] (Background on this error at: http://sqlalche.me/e/gkpj)
No handlers could be found for logger "invenio-pidstore"
Traceback (most recent call last):
  File "/home/kk/.virtualenvs/zenodo/bin/zenodo", line 11, in <module>
    load_entry_point('zenodo', 'console_scripts', 'zenodo')()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 257, in decorator
    return __ctx.invoke(f, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/cli.py", line 159, in loadlicenses_cli
    loadlicenses()
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/licenses.py", line 169, in loadlicenses
    license_minter(record.id, lic)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/invenio_opendefinition/minters.py", line 39, in license_minter
    status=PIDStatus.REGISTERED
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/invenio_pidstore/models.py", line 163, in create
    raise PIDAlreadyExists(pid_type=pid_type, pid_value=pid_value)
invenio_pidstore.errors.PIDAlreadyExists
Loaded 0 new funders out of 18.
Loaded 0 new grants out of 2.
Loading SIP metadata types...
  [####################################]  100%
Traceback (most recent call last):
  File "/home/kk/.virtualenvs/zenodo/bin/zenodo", line 11, in <module>
    load_entry_point('zenodo', 'console_scripts', 'zenodo')()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 257, in decorator
    return __ctx.invoke(f, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/cli.py", line 142, in loadsipmetadatatypes_cli
    loadsipmetadatatypes(types)
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/records.py", line 44, in loadsipmetadatatypes
    db.session.add(SIPMetadataType(**type))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 572, in __exit__
    self.rollback()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/util/langhelpers.py", line 66, in __exit__
    compat.reraise(exc_type, exc_value, exc_tb)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 569, in __exit__
    self.commit()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 467, in commit
    self._prepare_impl()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 447, in _prepare_impl
    self.session.flush()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2254, in flush
    self._flush(objects)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2380, in _flush
    transaction.rollback(_capture_exception=True)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/util/langhelpers.py", line 66, in __exit__
    compat.reraise(exc_type, exc_value, exc_tb)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2344, in _flush
    flush_context.execute()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/unitofwork.py", line 391, in execute
    rec.execute(self)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/unitofwork.py", line 556, in execute
    uow
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/persistence.py", line 181, in save_obj
    mapper, table, insert)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/persistence.py", line 866, in _emit_insert_statements
    execute(statement, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 948, in execute
    return meth(self, multiparams, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/sql/elements.py", line 269, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1060, in _execute_clauseelement
    compiled_sql, distilled_params
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1200, in _execute_context
    context)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1413, in _handle_dbapi_exception
    exc_info
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/util/compat.py", line 203, in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb, cause=cause)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1193, in _execute_context
    context)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/default.py", line 507, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.IntegrityError) duplicate key value violates unique constraint "uq_sipstore_sipmetadatatype_name"
DETAIL:  Key (name)=(json) already exists.
 [SQL: 'INSERT INTO sipstore_sipmetadatatype (title, name, format, schema) VALUES (%(title)s, %(name)s, %(format)s, %(schema)s) RETURNING sipstore_sipmetadatatype.id'] [parameters: {'title': u'Zenodo Record JSON v1.0.0', 'format': u'json', 'name': u'json', 'schema': u'https://zenodo.org/schemas/records/record-v1.0.0.json'}] (Background on this error at: http://sqlalche.me/e/gkpj)
Traceback (most recent call last):
  File "/home/kk/.virtualenvs/zenodo/bin/zenodo", line 11, in <module>
    load_entry_point('zenodo', 'console_scripts', 'zenodo')()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 722, in __call__
    return self.main(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 380, in main
    return AppGroup.main(self, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 697, in main
    rv = self.invoke(ctx)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 1066, in invoke
    return _process_result(sub_ctx.command.invoke(sub_ctx))
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 895, in invoke
    return ctx.invoke(self.callback, **ctx.params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/decorators.py", line 17, in new_func
    return f(get_current_context(), *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/flask/cli.py", line 257, in decorator
    return __ctx.invoke(f, *args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/click/core.py", line 535, in invoke
    return callback(*args, **kwargs)
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/cli.py", line 197, in loadusers_cli
    loaduser(user_data)
  File "/home/kk/src/zenodo/zenodo/modules/fixtures/users.py", line 46, in loaduser
    db.session.commit()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/scoping.py", line 153, in do
    return getattr(self.registry(), name)(*args, **kwargs)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 943, in commit
    self.transaction.commit()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 467, in commit
    self._prepare_impl()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 447, in _prepare_impl
    self.session.flush()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2254, in flush
    self._flush(objects)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2380, in _flush
    transaction.rollback(_capture_exception=True)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/util/langhelpers.py", line 66, in __exit__
    compat.reraise(exc_type, exc_value, exc_tb)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/session.py", line 2344, in _flush
    flush_context.execute()
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/unitofwork.py", line 391, in execute
    rec.execute(self)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/unitofwork.py", line 556, in execute
    uow
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/persistence.py", line 181, in save_obj
    mapper, table, insert)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/orm/persistence.py", line 866, in _emit_insert_statements
    execute(statement, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 948, in execute
    return meth(self, multiparams, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/sql/elements.py", line 269, in _execute_on_connection
    return connection._execute_clauseelement(self, multiparams, params)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1060, in _execute_clauseelement
    compiled_sql, distilled_params
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1200, in _execute_context
    context)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1413, in _handle_dbapi_exception
    exc_info
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/util/compat.py", line 203, in raise_from_cause
    reraise(type(exception), exception, tb=exc_tb, cause=cause)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/base.py", line 1193, in _execute_context
    context)
  File "/home/kk/.virtualenvs/zenodo/local/lib/python2.7/site-packages/sqlalchemy/engine/default.py", line 507, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.IntegrityError: (psycopg2.IntegrityError) duplicate key value violates unique constraint "uq_accounts_user_email"
DETAIL:  Key (email)=(info@zenodo.org) already exists.
 [SQL: 'INSERT INTO accounts_user (email, password, active, confirmed_at, last_login_at, current_login_at, last_login_ip, current_login_ip, login_count) VALUES (%(email)s, %(password)s, %(active)s, %(confirmed_at)s, %(last_login_at)s, %(current_login_at)s, %(last_login_ip)s, %(current_login_ip)s, %(login_count)s) RETURNING accounts_user.id'] [parameters: {'confirmed_at': None, 'login_count': None, 'last_login_ip': None, 'last_login_at': None, 'current_login_at': None, 'active': True, 'password': '$pbkdf2-sha512$25000$HiOkVKrV.p/TmvN.b02p9Q$7hptEGRzeOIaxjVc8mkVuppfH9XPaSIqFYQTdJBNPaa4arOrACo0/jiAX1ulDpvtLMMWyCkWQX9/fDjEAPAiEw', 'email': u'info@zenodo.org', 'current_login_ip': None}] (Background on this error at: http://sqlalche.me/e/gkpj)
Loaded 0 communities (skipped 2 existing).


Add - "INVENIO_CELERY_BROKER_URL=amqp://guest:guest@mq:5672//"  to zenodo/docker-services.yml environment variable.

